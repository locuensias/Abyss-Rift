<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abyss Rift - Control</title>
    <style>
        body {
            background-color: #0d1117; color: #c9d1d9;
            font-family: 'Segoe UI', monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; text-align: center;
        }
        h1 { margin-bottom: 5px; color: #58a6ff; letter-spacing: 2px; }
        
        .card {
            background: #161b22; border: 1px solid #30363d;
            border-radius: 16px; padding: 30px; width: 90%; max-width: 420px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.7);
        }

        .status-box { padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid transparent; transition: 0.3s;}
        
        .st-off-service { background: #222; border-color: #444; color: #777; }
        .st-offline { background: #3d1c1c; border-color: #da3633; color: #ffadad; }
        .st-online { background: #132e1d; border-color: #2ea043; color: #aff5b4; }
        .st-loading { background: #3d3408; border-color: #d29922; color: #f5e0b6; }

        .big-text { font-size: 28px; font-weight: 900; display: block; }
        .sub-text { font-size: 14px; opacity: 0.8; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat { background: #21262d; padding: 10px; border-radius: 6px; font-size: 14px; }
        .stat b { display: block; color: #fff; font-size: 18px; margin-top: 5px; }
        
        /* Estilo para lista de jugadores */
        #jug { word-wrap: break-word; font-size: 14px; line-height: 1.2; }

        .cmd-box { background: #000; padding: 15px; border-radius: 8px; text-align: left; border: 1px solid #30363d; }
        code { color: #a5d6ff; word-break: break-all; font-size: 13px; display: block; margin-bottom: 10px; }
        
        button {
            width: 100%; padding: 10px; border: none; border-radius: 5px;
            background: #238636; color: white; font-weight: bold; cursor: pointer;
        }
        button:hover { background: #2ea043; }

    </style>
</head>
<body>

    <div class="card">
        <h1>ABYSS RIFT</h1>
        <p style="font-size:12px; color:#8b949e; margin-bottom:20px;">IP: 201.188.110.226:25565</p>

        <div id="box" class="status-box st-off-service">
            <span id="status-txt" class="big-text">OFF SERVICE</span>
            <span id="desc-txt" class="sub-text">Sin conexión con el PC</span>
        </div>

        <div class="grid">
            <div class="stat">Temp CPU <b id="temp">-</b></div>
            <div class="stat">Batería <b id="bat">-</b></div>
            <div class="stat" style="grid-column: span 2;">
                En Línea: <b id="jug">-</b>
            </div>
        </div>

        <div class="cmd-box">
            <div style="font-size:11px; color:#8b949e; margin-bottom:5px; font-weight:bold;">⚡ COMANDO DE ENCENDIDO:</div>
            <code id="cmdCode">Invoke-RestMethod -Uri "http://201.188.110.226:5000/start"</code>
            <button onclick="copiar()" id="btn-copy">COPIAR AL PORTAPAPELES</button>
        </div>
        
        <p style="font-size: 10px; color: #555; margin-top: 15px;">
            *Si no actualiza, revisa que el candado del navegador permita contenido "no seguro" (http).
        </p>
    </div>

    <script>
        // LA CONSTANTE API DEBE APUNTAR A TU IP PÚBLICA
        const API = "http://201.188.110.226:5000";

        const ui = {
            box: document.getElementById('box'),
            txt: document.getElementById('status-txt'),
            desc: document.getElementById('desc-txt'),
            temp: document.getElementById('temp'),
            bat: document.getElementById('bat'),
            jug: document.getElementById('jug')
        };

        async function update() {
            try {
                // Timeout de 2 segundos para no colgar la página si el server está apagado
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), 2000);
                
                const res = await fetch(API + "/status", { signal: controller.signal });
                const data = await res.json();
                clearTimeout(id);

                ui.temp.innerText = data.temp;
                ui.bat.innerText = data.bateria;
                
                ui.jug.innerText = data.jugadores; 
                if(data.jugadores !== "Vacio" && data.jugadores !== "Nadie") {
                    ui.jug.style.color = "#a5d6ff"; 
                } else {
                    ui.jug.style.color = "#fff";
                }

                if (data.estado === "encendido") {
                    setVisual("st-online", "ONLINE", "Servidor Operativo");
                } else if (data.estado === "cargando") {
                    setVisual("st-loading", "INICIANDO", "Cargando mundo...");
                } else {
                    setVisual("st-offline", "OFFLINE", "PC Listo. Usa el comando.");
                }

            } catch (e) {
                setVisual("st-off-service", "OFF SERVICE", "Agente desconectado");
                ui.temp.innerText = "-";
                ui.bat.innerText = "-";
                ui.jug.innerText = "-";
            }
        }

        function setVisual(cls, title, desc) {
            ui.box.className = "status-box " + cls;
            ui.txt.innerText = title;
            ui.desc.innerText = desc;
        }

        function copiar() {
            const txt = document.getElementById('cmdCode').innerText;
            navigator.clipboard.writeText(txt);
            document.getElementById('btn-copy').innerText = "¡COPIADO!";
            setTimeout(() => document.getElementById('btn-copy').innerText = "COPIAR AL PORTAPAPELES", 2000);
        }

        setInterval(update, 3000);
        update();
    </script>
</body>
</html>
